<!doctype html>
<html lang="zh-cn">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>OneDrive ç›´é“¾è§£æ</title>
    <style>
      :root { 
        color-scheme: light dark; 
        --primary-color: #1668dc;
        --primary-hover: #0958d9;
        --error-color: #ff4d4f;
        --success-color: #52c41a;
        --border-color: #d9d9d9;
        --text-secondary: #666;
        --bg-card: #fff;
        --shadow: 0 2px 8px rgba(0,0,0,0.1);
      }
      
      @media (prefers-color-scheme: dark) {
        :root {
          --border-color: #424242;
          --text-secondary: #bbb;
          --bg-card: #1f1f1f;
          --shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
      }
      
      * { box-sizing: border-box; }
      
      body { 
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        margin: 0;
        padding: 2rem 1rem;
        line-height: 1.6;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }
      
      .container {
        max-width: 800px;
        margin: 0 auto;
        background: var(--bg-card);
        border-radius: 12px;
        padding: 2rem;
        box-shadow: var(--shadow);
      }
      
      h1 { 
        font-size: 2rem; 
        margin: 0 0 0.5rem;
        color: var(--primary-color);
        text-align: center;
      }
      
      .subtitle {
        text-align: center;
        color: var(--text-secondary);
        margin-bottom: 2rem;
        font-size: 1rem;
      }
      
      .form-group {
        margin-bottom: 1.5rem;
      }
      
      label { 
        display: block; 
        margin-bottom: 0.5rem;
        font-weight: 500;
        color: #333;
      }
      
      input[type="text"], input[type="number"] { 
        width: 100%; 
        padding: 0.75rem 1rem; 
        border: 2px solid var(--border-color); 
        border-radius: 8px;
        font-size: 1rem;
        transition: border-color 0.3s ease;
      }
      
      input[type="text"]:focus, input[type="number"]:focus {
        outline: none;
        border-color: var(--primary-color);
      }
      

      
      .btn {
        width: 100%;
        padding: 0.75rem 1.5rem; 
        border: none; 
        border-radius: 8px; 
        background: var(--primary-color); 
        color: white; 
        cursor: pointer;
        font-size: 1rem;
        font-weight: 500;
        transition: background-color 0.3s ease;
        margin-top: 1rem;
      }
      
      .btn:hover { 
        background: var(--primary-hover);
      }
      
      .btn:active {
        transform: translateY(1px);
      }
      
      .card { 
        margin-top: 2rem; 
        padding: 1.5rem; 
        border-radius: 8px;
        border: 1px solid var(--border-color);
      }
      
      .error { 
        background: #fff2f0;
        border-color: var(--error-color);
        color: var(--error-color);
      }
      
      .success {
        background: #f6ffed;
        border-color: var(--success-color);
      }
      
      .result-url {
        background: #f5f5f5;
        padding: 1rem;
        border-radius: 6px;
        margin: 1rem 0;
        word-break: break-all;
        font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
        font-size: 0.9rem;
        border: 1px solid var(--border-color);
      }
      
      .result-actions {
        display: flex;
        gap: 1rem;
        margin-top: 1rem;
      }
      
      .btn-secondary {
        background: #6c757d;
        color: white;
        text-decoration: none;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        font-size: 0.9rem;
        transition: background-color 0.3s ease;
      }
      
      .btn-secondary:hover {
        background: #5a6268;
        text-decoration: none;
        color: white;
      }
      
      .copy-btn {
        background: var(--success-color);
      }
      
      .copy-btn:hover {
        background: #389e0d;
      }
      
      .notice {
        margin-top: 2rem;
        padding: 1rem;
        background: #f0f8ff;
        border-left: 4px solid var(--primary-color);
        border-radius: 0 8px 8px 0;
        font-size: 0.9rem;
        color: var(--text-secondary);
      }
      
      .history-container {
        max-height: 400px;
        overflow-y: auto;
        border: 1px solid #e9ecef;
        border-radius: 8px;
        background: #f8f9fa;
      }
      
      .history-item {
        padding: 15px;
        border-bottom: 1px solid #e9ecef;
        background: white;
        margin-bottom: 1px;
        transition: background-color 0.2s ease;
      }
      
      .history-item:hover {
        background: #f0f8ff;
      }
      
      .history-item:last-child {
        border-bottom: none;
      }
      
      .history-time {
        font-size: 0.8rem;
        color: #6c757d;
        margin-bottom: 5px;
      }
      
      .history-remark-container {
        margin-bottom: 8px;
      }
      
      .history-remark {
        font-weight: bold;
        color: var(--primary-color);
        cursor: pointer;
        padding: 4px 8px;
        border-radius: 4px;
        transition: background-color 0.2s;
        display: inline-block;
        min-width: 100px;
        border: 1px solid transparent;
      }
      
      .history-remark:hover {
        background-color: #f8f9fa;
        border-color: #dee2e6;
      }
      
      .history-remark-input {
        width: 100%;
        padding: 4px 8px;
        border: 1px solid #007bff;
        border-radius: 4px;
        font-size: 14px;
        font-weight: bold;
        background-color: white;
        outline: none;
        color: var(--primary-color);
      }
      
      .history-url {
        font-family: monospace;
        font-size: 0.85rem;
        background: #f8f9fa;
        padding: 5px 8px;
        border-radius: 4px;
        word-break: break-all;
        margin-bottom: 8px;
      }
      
      .history-actions {
        display: flex;
        gap: 10px;
      }
      
      .history-btn {
        padding: 4px 8px;
        font-size: 0.8rem;
        border: none;
        border-radius: 4px;
        cursor: pointer;
        text-decoration: none;
        display: inline-block;
      }
      
      .history-copy {
        background: var(--success-color);
        color: white;
      }
      
      .history-download {
        background: var(--primary-color);
        color: white;
      }
      
      .history-delete {
        background: #dc3545;
        color: white;
      }
      
              @media (max-width: 768px) {
        body { padding: 1rem 0.5rem; }
        .container { padding: 1.5rem; }
        .result-actions { flex-direction: column; }
        h1 { font-size: 1.5rem; }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>OneDrive ç›´é“¾è§£æ</h1>
      <p class="subtitle">æ”¯æŒä¸ªäººç‰ˆã€æµ·å¤–ä¼ä¸šç‰ˆã€ä¸–çºªäº’è”ç‰ˆ OneDrive/SharePoint åˆ†äº«é“¾æ¥</p>
      
      <form method="post">
        <div class="form-group">
          <label for="share_url">åˆ†äº«é“¾æ¥</label>
          <input 
            type="text" 
            id="share_url" 
            name="share_url" 
            placeholder="ç²˜è´´ OneDrive/SharePoint åˆ†äº«é“¾æ¥..." 
            value="{{ form.get('share_url','') }}" 
            required 
            ondblclick="clearUrlInput()"
          />
        </div>



        <button type="submit" class="btn">è§£æç›´é“¾</button>
      </form>

      {% if error %}
      <div class="card error">
        <strong>âŒ è§£æå¤±è´¥</strong><br>
        {{ error }}
      </div>
      {% endif %}

      {% if result %}
      <div class="card success">
        <div><strong>âœ… è§£ææˆåŠŸ</strong></div>
        <div class="result-url">{{ result }}</div>
        <div class="result-actions">
          <button class="btn-secondary copy-btn" onclick="copyToClipboard('{{ result }}')">å¤åˆ¶é“¾æ¥</button>
          <a href="{{ result }}" download class="btn-secondary">ä¸‹è½½æ–‡ä»¶</a>
        </div>
        
        <!-- æ·»åŠ å¤‡æ³¨åŠŸèƒ½ -->
        <div style="margin-top: 15px;">
          <label for="remark" style="display: block; margin-bottom: 5px; font-weight: bold;">æ–‡ä»¶å¤‡æ³¨ï¼ˆå¿…å¡«ï¼‰ï¼š</label>
          <input type="text" id="remark" placeholder="è¯·è¾“å…¥æ–‡ä»¶åæˆ–å¤‡æ³¨ä¿¡æ¯" style="width: 70%; padding: 8px; border: 1px solid #ddd; border-radius: 4px;" required>
          <button onclick="saveToHistoryWithValidation('{{ result }}')" class="btn-secondary" style="margin-left: 10px;">ä¿å­˜åˆ°å†å²</button>
        </div>
        {% if 'dlink.host/1drv/' in result %}
        <div style="margin-top: 15px; padding: 10px; background: #d1ecf1; border: 1px solid #bee5eb; border-radius: 5px; font-size: 0.9em;">
          <p><strong>ğŸ‰ çœŸæ­£çš„æ— ç™»å½•ç›´é“¾ï¼š</strong></p>
          <p>ä½¿ç”¨ <code>dlink.host</code> æœåŠ¡ç”Ÿæˆï¼Œé€šè¿‡æå– <code>redeem</code> å‚æ•°å®ç°ã€‚è¿™æ˜¯ç›®å‰æœ€æœ‰æ•ˆçš„ä¸ªäººç‰ˆOneDriveç›´é“¾ç”Ÿæˆæ–¹æ³•ï¼</p>
          <p style="margin-top: 8px; font-size: 0.85em; color: #0c5460;">
            <strong>ä¼˜åŠ¿ï¼š</strong>æ— éœ€ç™»å½•ã€æ”¯æŒç›´æ¥ä¸‹è½½ã€å…¼å®¹æ€§å¼º
          </p>
        </div>
        {% elif 'onedrive.live.com' in result %}
          {% if 'download?resid=' in result %}
        <div style="margin-top: 15px; padding: 10px; background: #d4edda; border: 1px solid #c3e6cb; border-radius: 5px; font-size: 0.9em;">
          <p><strong>âœ¨ ä¼˜åŒ–ç›´é“¾ï¼š</strong></p>
          <p>ç”Ÿæˆäº†ä¼˜åŒ–çš„ä¸ªäººç‰ˆOneDriveç›´é“¾ï¼Œä½¿ç”¨ä¼ ç»Ÿçš„resid+authkeyæ ¼å¼ã€‚</p>
        </div>
          {% elif 'download=1' in result %}
        <div style="margin-top: 15px; padding: 10px; background: #fff3cd; border: 1px solid #ffeaa7; border-radius: 5px; font-size: 0.9em;">
          <p><strong>âš ï¸ ä¼ ç»Ÿæ ¼å¼ï¼š</strong></p>
          <p>ç”Ÿæˆçš„æ˜¯ä¼ ç»Ÿæ ¼å¼ç›´é“¾ï¼Œå¯èƒ½éœ€è¦ç™»å½•ã€‚å»ºè®®æ£€æŸ¥åŸå§‹é“¾æ¥æ˜¯å¦ä¸ºå…¬å¼€åˆ†äº«é“¾æ¥ã€‚</p>
        </div>
          {% endif %}
        {% endif %}
      </div>
      {% endif %}

      <!-- å†å²è®°å½•åŒºåŸŸ -->
      <div id="history-section" style="margin-top: 2rem;">
        <h3 style="color: var(--primary-color); margin-bottom: 1rem;">ğŸ“‹ è§£æå†å²</h3>
        
        <!-- æœç´¢æ¡† -->
        <div style="margin-bottom: 1rem;">
          <input type="text" id="search-input" placeholder="æœç´¢å¤‡æ³¨å..." style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px;" oninput="searchHistory()">
        </div>
        
        <div id="history-list" class="history-container">
          <!-- å†å²è®°å½•å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
        </div>
      </div>

      <div class="notice">
        <strong>ä½¿ç”¨è¯´æ˜ï¼š</strong>
        <ul style="margin: 0.5rem 0 0; padding-left: 1.2rem;">
          <li>ä»…æ”¯æŒæ–‡ä»¶åˆ†äº«é“¾æ¥ï¼Œæ–‡ä»¶å¤¹é“¾æ¥æ— æ³•ç”Ÿæˆç›´é“¾</li>
          <li>ä¸–çºªäº’è”å’Œä¼ä¸šç‰ˆç›´æ¥ç”Ÿæˆ <code>/_layouts/52/download.aspx</code> æ ¼å¼çš„ç›´é“¾ï¼Œæ— éœ€ç™»å½•</li>
          <li>ä¸ªäººç‰ˆä¼˜å…ˆä½¿ç”¨ <code>dlink.host</code> æœåŠ¡ç”ŸæˆçœŸæ­£çš„æ— ç™»å½•ç›´é“¾</li>
          <li><strong>è§£ææˆåŠŸåé“¾æ¥ä¼šè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆé™é»˜å¤åˆ¶ï¼‰</strong></li>
          <li><strong>å¿…é¡»å¡«å†™æ–‡ä»¶å¤‡æ³¨åæ‰èƒ½ä¿å­˜åˆ°å†å²è®°å½•</strong></li>
          <li>å¯ä»¥åœ¨æœç´¢æ¡†ä¸­è¾“å…¥å…³é”®è¯æœç´¢å†å²è®°å½•</li>
        </ul>
      </div>
    </div>

    <script>
      // å†å²è®°å½•ç®¡ç†
      let historyData = JSON.parse(localStorage.getItem('onedrive-history') || '[]');
      
      // æ˜¾ç¤ºToastæç¤ºï¼ˆæ›¿ä»£alertï¼‰
      function showToast(message, type = 'success') {
        const toast = document.createElement('div');
        toast.textContent = message;
        
        const colors = {
          success: { bg: '#28a745', color: 'white' },
          error: { bg: '#dc3545', color: 'white' },
          info: { bg: '#17a2b8', color: 'white' }
        };
        
        const color = colors[type] || colors.success;
        
        toast.style.cssText = `
          position: fixed;
          top: 20px;
          right: 20px;
          background: ${color.bg};
          color: ${color.color};
          padding: 12px 20px;
          border-radius: 6px;
          z-index: 10000;
          font-size: 14px;
          box-shadow: 0 4px 12px rgba(0,0,0,0.15);
          animation: slideInRight 0.3s ease;
          max-width: 300px;
          word-wrap: break-word;
        `;
        
        // æ·»åŠ åŠ¨ç”»æ ·å¼
        if (!document.getElementById('toast-style')) {
          const style = document.createElement('style');
          style.id = 'toast-style';
          style.textContent = `
            @keyframes slideInRight {
              from { transform: translateX(100%); opacity: 0; }
              to { transform: translateX(0); opacity: 1; }
            }
            @keyframes slideOutRight {
              from { transform: translateX(0); opacity: 1; }
              to { transform: translateX(100%); opacity: 0; }
            }
          `;
          document.head.appendChild(style);
        }
        
        document.body.appendChild(toast);
        
        // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
          toast.style.animation = 'slideOutRight 0.3s ease';
          setTimeout(() => {
            if (toast.parentNode) {
              toast.parentNode.removeChild(toast);
            }
          }, 300);
        }, 3000);
      }
      
      // é™é»˜å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆç”¨äºè‡ªåŠ¨å¤åˆ¶ï¼‰
      async function silentCopyToClipboard(text) {
        try {
          await navigator.clipboard.writeText(text);
        } catch (err) {
          // é™çº§æ–¹æ¡ˆ - é™é»˜æ‰§è¡Œ
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
        }
      }
      
      // å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼ˆç”¨äºæ‰‹åŠ¨ç‚¹å‡»å¤åˆ¶æŒ‰é’®ï¼‰
      async function copyToClipboard(text) {
        try {
          await navigator.clipboard.writeText(text);
          const btn = event.target;
          const originalText = btn.textContent;
          btn.textContent = 'å·²å¤åˆ¶!';
          btn.style.background = '#52c41a';
          setTimeout(() => {
            btn.textContent = originalText;
            btn.style.background = '#52c41a';
          }, 2000);
        } catch (err) {
          // é™çº§æ–¹æ¡ˆ
          const textArea = document.createElement('textarea');
          textArea.value = text;
          document.body.appendChild(textArea);
          textArea.select();
          document.execCommand('copy');
          document.body.removeChild(textArea);
          showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿');
        }
      }
      
      // å¸¦éªŒè¯çš„ä¿å­˜åˆ°å†å²è®°å½•
      function saveToHistoryWithValidation(url) {
        const remarkInput = document.getElementById('remark');
        const remark = remarkInput.value.trim();
        
        if (!remark) {
          showToast('è¯·å…ˆå¡«å†™æ–‡ä»¶å¤‡æ³¨ï¼', 'error');
          remarkInput.focus();
          remarkInput.style.borderColor = '#dc3545';
          return;
        }
        
        // é‡ç½®è¾¹æ¡†é¢œè‰²
        remarkInput.style.borderColor = '#ddd';
        
        saveToHistory(url, remark);
        
        // æ¸…ç©ºè¾“å…¥æ¡†
        remarkInput.value = '';
      }
      
      // ä¿å­˜åˆ°å†å²è®°å½•
      function saveToHistory(url, remark) {
        const timestamp = new Date().toLocaleString('zh-CN');
        const historyItem = {
          id: Date.now(),
          url: url,
          remark: remark,
          timestamp: timestamp
        };
        
        // é¿å…é‡å¤æ·»åŠ ç›¸åŒçš„URL
        const existingIndex = historyData.findIndex(item => item.url === url);
        if (existingIndex !== -1) {
          historyData[existingIndex] = historyItem; // æ›´æ–°ç°æœ‰è®°å½•
        } else {
          historyData.unshift(historyItem); // æ·»åŠ åˆ°å¼€å¤´
        }
        
        // é™åˆ¶å†å²è®°å½•æ•°é‡ï¼ˆæœ€å¤š50æ¡ï¼‰
        if (historyData.length > 50) {
          historyData = historyData.slice(0, 50);
        }
        
        localStorage.setItem('onedrive-history', JSON.stringify(historyData));
        displayHistory();
        
        // å‘é€åˆ°åç«¯è®°å½•æ—¥å¿—
        fetch('/save_history', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify(historyItem)
        }).catch(err => console.log('æ—¥å¿—è®°å½•å¤±è´¥:', err));
        
        showToast('å·²ä¿å­˜åˆ°å†å²è®°å½•ï¼');
      }
      
      // ç§»é™¤è‡ªåŠ¨ä¿å­˜åŠŸèƒ½ï¼Œç”¨æˆ·å¿…é¡»æ‰‹åŠ¨å¡«å†™å¤‡æ³¨åä¿å­˜
      
      // è‡ªåŠ¨å¤åˆ¶è§£ææˆåŠŸçš„é“¾æ¥åˆ°å‰ªè´´æ¿
      function autoCopyResult() {
        const resultUrl = document.querySelector('.result-url');
        if (resultUrl) {
          const url = resultUrl.textContent.trim();
          if (url) {
            silentCopyToClipboard(url);
            // é™é»˜å¤åˆ¶ï¼Œä¸æ˜¾ç¤ºæç¤º
          }
        }
      }
      
      // æœç´¢å†å²è®°å½•
      function searchHistory() {
        const searchTerm = document.getElementById('search-input').value.toLowerCase().trim();
        displayHistory(searchTerm);
      }
      
      // æ˜¾ç¤ºå†å²è®°å½•
      function displayHistory(searchTerm = '') {
        const historyList = document.getElementById('history-list');
        
        // æ ¹æ®æœç´¢è¯è¿‡æ»¤å†å²è®°å½•
        let filteredData = historyData;
        if (searchTerm) {
          filteredData = historyData.filter(item => 
            item.remark.toLowerCase().includes(searchTerm)
          );
        }
        
        if (filteredData.length === 0) {
          const message = searchTerm ? 
            `<div style="padding: 20px; text-align: center; color: #6c757d;">æœªæ‰¾åˆ°åŒ…å« "${searchTerm}" çš„è®°å½•</div>` :
            '<div style="padding: 20px; text-align: center; color: #6c757d;">æš‚æ— å†å²è®°å½•</div>';
          historyList.innerHTML = message;
          return;
        }
        
        historyList.innerHTML = filteredData.map(item => `
          <div class="history-item">
            <div class="history-time">${item.timestamp}</div>
            <div class="history-remark-container">
              <span class="history-remark" id="remark-${item.id}" onclick="editRemark(${item.id})">${highlightSearchTerm(item.remark, searchTerm)}</span>
              <input type="text" class="history-remark-input" id="input-${item.id}" value="${item.remark}" style="display: none;" onblur="saveRemark(${item.id})" onkeypress="handleRemarkKeypress(event, ${item.id})">
            </div>
            <div class="history-url">${item.url}</div>
            <div class="history-actions">
              <button class="history-btn history-copy" onclick="copyToClipboard('${item.url}')">å¤åˆ¶</button>
              <a href="${item.url}" download class="history-btn history-download">ä¸‹è½½</a>
              <button class="history-btn history-delete" onclick="deleteHistoryItem(${item.id})">åˆ é™¤</button>
            </div>
          </div>
        `).join('');
      }
      
      // é«˜äº®æœç´¢å…³é”®è¯
      function highlightSearchTerm(text, searchTerm) {
        if (!searchTerm) return text;
        
        const regex = new RegExp(`(${searchTerm.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
        return text.replace(regex, '<mark style="background: #ffeb3b; padding: 1px 2px; border-radius: 2px;">$1</mark>');
      }
      
      // ç¼–è¾‘å¤‡æ³¨
      function editRemark(id) {
        const remarkSpan = document.getElementById(`remark-${id}`);
        const remarkInput = document.getElementById(`input-${id}`);
        
        remarkSpan.style.display = 'none';
        remarkInput.style.display = 'inline-block';
        remarkInput.focus();
        remarkInput.select();
      }
      
      // ä¿å­˜å¤‡æ³¨
      function saveRemark(id) {
        const remarkSpan = document.getElementById(`remark-${id}`);
        const remarkInput = document.getElementById(`input-${id}`);
        const newRemark = remarkInput.value.trim();
        
        if (!newRemark) {
          showToast('å¤‡æ³¨ä¸èƒ½ä¸ºç©ºï¼', 'error');
          remarkInput.focus();
          return;
        }
        
        // æ›´æ–°å†å²æ•°æ®
        const itemIndex = historyData.findIndex(item => item.id === id);
        if (itemIndex !== -1) {
          historyData[itemIndex].remark = newRemark;
          localStorage.setItem('onedrive-history', JSON.stringify(historyData));
          
          // åŒæ­¥åˆ°åç«¯
          fetch('/save_history', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
            },
            body: JSON.stringify(historyData[itemIndex])
          }).catch(err => console.log('åŒæ­¥å¤±è´¥:', err));
          
          showToast('å¤‡æ³¨å·²æ›´æ–°ï¼');
        }
        
        // åˆ‡æ¢å›æ˜¾ç¤ºæ¨¡å¼
        remarkSpan.style.display = 'inline-block';
        remarkInput.style.display = 'none';
        
        // é‡æ–°æ˜¾ç¤ºå†å²è®°å½•ä»¥æ›´æ–°å†…å®¹
        displayHistory();
      }
      
      // å¤„ç†å¤‡æ³¨è¾“å…¥çš„æŒ‰é”®äº‹ä»¶
      function handleRemarkKeypress(event, id) {
        if (event.key === 'Enter') {
          saveRemark(id);
        } else if (event.key === 'Escape') {
          // å–æ¶ˆç¼–è¾‘
          const remarkSpan = document.getElementById(`remark-${id}`);
          const remarkInput = document.getElementById(`input-${id}`);
          
          remarkSpan.style.display = 'inline-block';
          remarkInput.style.display = 'none';
          
          // æ¢å¤åŸå§‹å€¼
          const originalRemark = historyData.find(item => item.id === id)?.remark || '';
          remarkInput.value = originalRemark;
        }
      }
      
      // åˆ é™¤å†å²è®°å½•é¡¹
      function deleteHistoryItem(id) {
        if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡è®°å½•å—ï¼Ÿ')) {
          historyData = historyData.filter(item => item.id !== id);
          localStorage.setItem('onedrive-history', JSON.stringify(historyData));
          displayHistory();
        }
      }
      
      // åŒå‡»æ¸…é™¤URLè¾“å…¥æ¡†å†…å®¹
      function clearUrlInput() {
        const urlInput = document.getElementById('share_url');
        urlInput.value = '';
        urlInput.focus();
        showToast('è¾“å…¥æ¡†å·²æ¸…ç©ºï¼', 'info');
      }
      
      // é¡µé¢åŠ è½½æ—¶æ˜¾ç¤ºå†å²è®°å½•
      document.addEventListener('DOMContentLoaded', function() {
        displayHistory();
        
        // å¦‚æœé¡µé¢æœ‰è§£æç»“æœï¼Œè‡ªåŠ¨å¤åˆ¶åˆ°å‰ªè´´æ¿
        const resultUrl = document.querySelector('.result-url');
        if (resultUrl) {
          setTimeout(() => autoCopyResult(), 500); // å»¶è¿Ÿ500msç¡®ä¿é¡µé¢å®Œå…¨åŠ è½½
        }
      });
    </script>
  </body>
</html>